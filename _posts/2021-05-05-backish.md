---
published: false
---
## wew

After a traumatic, tearful goodbye to weird glxgears which took more out of me than expected, I'm back and blogging again.

It's been...

Well, I guess it's been a while since my last post, huh.

So what's happened since then?

Lots? Yeah, definitely lots. It's May now. And there's even been a new Mesa release since then.

Quick zink roundup in case you missed any of these:
* shader clocks are in
* sparse buffer support is in
* 16bit ALU support is in
* GPU memory queries are in

Cool.

## But What's Really Been Going On?
The truth is that I've been taking some time off from zink in a completely futile attempt to make progress on something else while zink-wip continues to land. Inspired by [this ticket](https://gitlab.freedesktop.org/zmike/mesa/-/issues/89) describing issues getting CS:GO working, I decideded to tackle part of Mesa that I haven't worked on much and that hasn't seen much work in a long time:

PBOs.

## PBO TIME
**P**ixel **B**uffer **O**bjects are used when an application needs to perform a transfer of an image from host memory to the GPU or vice versa. A PBO is said to be downloaded when it is copied from the GPU into a host memory buffer, and it is uploaded when it is copied from a memory buffer into GPU memory. PBO uploads are a common way to load assets from disk (e.g., textures), and PBO downloads are common for...ideally nothing performance related, but RPCS3 uses them in such a way.

The reason CS:GO takes forever to start with zink is because it performs texture (PBO) uploads of formats which zink does not support, namely alpha and luminance formats, during startup in order to load assets onto the GPU.

Uploading of textures in Mesa can take a number of different codepaths depending on various factors using this priority chain:
* If the format and data type of the pixels is compatible with the format of the texture used for the upload, they can be directly copied by the driver. *this is the fastest method*
* If the driver supports shader images and the texture format is supported, Gallium will generate a fragment shader which binds the data-to-be-uploaded as a bufferview, the texture as a framebuffer attachment, and then samples to the framebuffer. *this is pretty fast*
* If the format of the host memory buffer (the data being uploaded