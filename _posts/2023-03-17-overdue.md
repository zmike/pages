---
published: false
---
## I Meant To Write This Some Time Ago But Then I Didn't

The blog has been there before, it'll be there again, I'm over it.

Let's talk about the only thing anyone cares about on this blog for the 23.1 release cycle: **perf**.

What does it mean? Who knows.

How does one acquire it? See above.

But everyone wants it, so I've gotta deliver like a hypothetical shipping company that delivers on-time and actually rings the bell when they drop something off instead of just hucking a box onto my front porch and running away to leave my stuff sitting out to get snowed on.

Unlike such a hypothetical shipping company which doesn't exist, **perf** does exist, and I've got it. Lots of it.

Let's talk about what parts of my soul I had to sell to get to this point in my life.

## Time-bending
Fans of the blog will recall I [previously wrote a post]({{site.url}}/new-news) that had great SEO for problem spaces and temporal ordering of events. This functionality, rewriting GL commands on-the-fly, has since been dubbed "time-bending" by prominent community members, so I guess that's what we're calling it since naming is the most important part of any technical challenge.

Initially, I implemented *time-bending* to be able to reorder some barriers and transfer operations and avoid splitting renderpasses, something that only the savages living in tiling GPU land care about. Is it useful on immediate-mode rendering GPUs, the ones we use in our daily lives for real work (NOT GAMING DON'T ASK ABOUT GAMING)?

Maybe? Outlook uncertain. Try again later.

So I'm implementing these great features with great names that are totally getting used by real people, and then notable **perf** anthropologist Emma Anholt comes to me and asks why zink is spewing out a thousand TRANSFER barriers for sequences of subdata calls. I'm sitting in front of my computer staring at the charts, checking over the data, looking at the graphs, and I don't have an answer.

At that point in my life, three weeks ago before I embarked on a sleepless, not-leaving-my-house-until-the-perf-was-extant adventure, I thought I knew how to **perf**. It's something anyone can do, isn't it?

Obviously not. **perf** isn't a verb.

## The First Step
I had to start by discarding any ideas I had about **perf**. Clearly I knew nothing based on the reports I was getting: zink was being absolutely slaughtered in benchmarks across the board to a truly embarrassing degree by both ANGLE and native drivers.

And this question about TRANSFER barriers ended up being the spark of inspiration that would lead to an uphill journey to figure out what **perf** was.

To make it simple, suppose this sequence of operations occurs:
* `copy(src_buffer, dst_buffer, src_offset=0, dst_offset=0, size=64)`
* `copy(src_buffer, dst_buffer, src_offset=128, dst_offset=128, size=64)`
* `copy(src_buffer, dst_buffer, src_offset=256, dst_offset=256, size=64)`

Now here's a trick question: are barriers required between these operations?

If you answered *no*, you're right. But also you're wrong if you're on certain hardware/driver combos which are (currently) extremely broken. Let's pretend we don't know about those for the sake of what sanity remains.

